{%extends 'Portfolios/base_portfolio.html' %}
{%load staticfiles%}
{% load cloudinary %}

{%block cloudinary%}
    {% cloudinary_includes %}
    {% cloudinary_js_config %}

{% endblock %}

{%block app_css%}
  <link rel='stylesheet' type='text/css' href ="{%static 'Portfolios/css/create_chapter.css'%}"/>
{%endblock%}


{%block content%}
	<div id="direct_upload" class="row" style="width:50%; margin:2% auto">
        <h2>Add a New Chapter</h2>
        {{error}}
		<form method='POST' id='create-chapter' action="{% url 'Portfolios:create_chapter' request.user.username design_story_id slug%}" class="chapter-form">
			{%csrf_token%}
            {%for field in entry_form%}
                <div class = 'form-group'>
                    <div>{{field.errors|striptags}}</div>
                    {{field.label_tag}}
                    {% if field.label == 'Cover Photo' %}
                        <br/>
                        <a href="#" id="cover_upload_widget_opener"></a>
                    {% elif field.label == 'Additional Photos'%}
                        <br/>
                        <a href="#" id="supp_upload_widget_opener"></a>
                    {% else %}
                        {{field}}
                    {% endif %}
                </div>
            {%endfor%} 
            <button type = 'submit' class = 'btn btn-primary' id="create-btn" disabled='true'>Create</button>
		</form>

    <script src="{%static 'Portfolios/js/uploadwidget.js' %}"></script>
    <script type="text/javascript">
        function updateNumPhotos(){
            photos_upload++;
            if(photos_upload > 0)
            {
                $("#create-btn").attr("disabled",false);
            }
        }

        var widget_options = { cloud_name: 'thimbleapp', upload_preset: 'orphans', multiple:false, form:'#create-chapter',
          cropping: 'server', cropping_aspect_ratio:0.73, field_name:"",theme:"minimal",thumbnails: '',
            thumbnail_transformation: { width: 400, height: 550, crop: 'fill' }};


      widget_options.field_name = 'cover_photo';
      widget_options.thumbnails = '.cover-group';
      $('#cover_upload_widget_opener').cloudinary_upload_widget(widget_options,
        function(error, result) {
            // TODO change "Upload Cover" on button to "Change cover"
        });

      var photos_upload = 0;

        widget_options.field_name = 'entry_photos';
        widget_options.thumbnails = '.supp-group';
      $('#supp_upload_widget_opener').cloudinary_upload_widget(widget_options,
        function(error, result) {
            updateNumPhotos();
                // TODO error handle here
        });
    </script>

	</div>

{%endblock%}