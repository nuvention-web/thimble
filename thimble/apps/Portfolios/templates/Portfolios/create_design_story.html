{%extends 'Portfolios/base_portfolio.html' %}
{%load staticfiles%}
{% load cloudinary %}

{%block cloudinary%}
    {% cloudinary_includes %}
    {% cloudinary_js_config %}
{% endblock %}



{%block content%}
	<div id="direct_upload" class="row" style="width:50%; margin:2% auto">
        <h2> Create a Design Story</h2>
        {{error}}
		<form method='post' action="{%url 'Portfolios:create_design_story' request.user.username%}">
			{%csrf_token%}
            {% for field in design_story_form %}
                <div class = 'form-group'>
                    <div>{{field.errors|striptags}}</div>
                    {{field.label_tag}}
                    {{field}}
                </div>
            {% endfor %}
            <hr/>
            <h3>Create Your First Chapter</h3>
            {%for field in entry_form%}
                <div class = 'form-group'>
                    <div>{{field.errors|striptags}}</div>
                    {{field.label_tag}}
                    {% if field.label == 'Cover Photo' %}
                        <br/>
                        <a href="#" id="cover_upload_widget_opener"></a>
                    {% elif field.label == 'Additional Photos'%}
                        <br/>
                        <a href="#" id="supp_upload_widget_opener"></a>
                    {% else %}
                        {{field}}
                    {% endif %}
                </div>
            {%endfor%} 
            <button type='submit' class='btn btn-primary' id="create-btn" disabled="true">Create</button>
        </form>

            <script src="{%static 'Portfolios/js/uploadwidget.js' %}"></script>

            <script type="text/javascript">
                function updateNumPhotos(){
                    photos_upload++;
                    if(photos_upload > 0)
                    {
                        $("#create-btn").attr("disabled",false);
                    }
                }

              $('#cover_upload_widget_opener').cloudinary_upload_widget(
                { cloud_name: 'thimbleapp', upload_preset: 'orphans', multiple:false,
                  cropping: 'server', cropping_aspect_ratio:0.73, button_caption:"Upload Cover", field_name:"cover_photo",theme:"minimal",
            thumbnail_transformation: { width: 400, height: 550, crop: 'limit' }},
                function(error, result) {
                    // TODO change "Upload Cover" on button to "Change cover"
                });

              var photos_upload = 0;
              $('#supp_upload_widget_opener').cloudinary_upload_widget(
                { cloud_name: 'thimbleapp', upload_preset: 'orphans', multiple:true,
                  cropping: 'server', cropping_aspect_ratio:0.73, button_caption:"Upload Additional", field_name:"entry_photos", theme:"minimal",
            thumbnail_transformation: { width: 400, height: 550, crop: 'limit' }},
                function(error, result) {
                    updateNumPhotos();
                        // TODO error handle here
                });
            </script>

		
        <div class='status' hidden='true'>
            <h3>Photo Upload Status</h3>
        </div>
	</div>

{%endblock%}